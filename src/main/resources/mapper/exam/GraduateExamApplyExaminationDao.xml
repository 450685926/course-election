<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.server.edu.exam.dao.GraduateExamApplyExaminationDao">
  <resultMap id="BaseResultMap" type="com.server.edu.exam.entity.GraduateExamApplyExamination">
    <!--
      WARNING - @mbg.generated
    -->
    <id column="ID_" jdbcType="BIGINT" property="id" />
    <result column="CALENDAR_ID_" jdbcType="BIGINT" property="calendarId" />
    <result column="APPLY_SOURCE_" jdbcType="INTEGER" property="applySource" />
    <result column="STUDENT_CODE_" jdbcType="VARCHAR" property="studentCode" />
    <result column="COURSE_CODE_" jdbcType="VARCHAR" property="courseCode" />
    <result column="APPLY_TYPE_" jdbcType="INTEGER" property="applyType" />
    <result column="APPLY_STATUS_" jdbcType="INTEGER" property="applyStatus" />
    <result column="APPLY_REASON_" jdbcType="VARCHAR" property="applyReason" />
    <result column="ADUIT_OPINIONS_" jdbcType="VARCHAR" property="aduitOpinions" />
    <result column="PROJ_ID_" jdbcType="VARCHAR" property="projId" />
    <result column="CREATE_AT_" jdbcType="TIMESTAMP" property="createAt" />
    <result column="UPDATE_AT_" jdbcType="TIMESTAMP" property="updateAt" />
    <result column="REMARK_" jdbcType="VARCHAR" property="remark" />
  </resultMap>

  <resultMap id="VoBaseResultMap" type="com.server.edu.exam.vo.GraduateExamApplyExaminationVo" extends="BaseResultMap">
    <result column="studentName" jdbcType="VARCHAR" property="studentName" />
    <result column="courseName" jdbcType="VARCHAR" property="courseName" />
    <result column="collenge" jdbcType="VARCHAR" property="collenge" />
    <result column="campus" jdbcType="VARCHAR" property="campus" />
  </resultMap>

  <select id="listGraduateApply" parameterType="com.server.edu.exam.vo.GraduateExamApplyExaminationVo" resultMap="VoBaseResultMap">
    select
    t1.ID_,t1.CALENDAR_ID_,t1.APPLY_SOURCE_,t1.STUDENT_CODE_,t1.COURSE_CODE_,t1.APPLY_TYPE_,t1.APPLY_STATUS_,t1.APPLY_REASON_,t1.ADUIT_OPINIONS_
    ,t2.NAME_ studentName,t3.NAME_ courseName,t2.CAMPUS_ campus,t2.FACULTY_ collenge
    from graduate_exam_apply_examination_t t1
    left join student_t t2 on t2.STUDENT_CODE_ = t1.STUDENT_CODE_
    left join course_t t3 on t3.CODE_ = t1.COURSE_CODE_
    <where>
      <if test="@com.server.edu.util.MybatisUtil@isNotEmpty(keyword)">
        and ( t1.STUDENT_CODE_ like concat ('%', #{keyword},'%') or t1.COURSE_CODE_ like concat ('%', #{keyword},'%')
        or t2.NAME_ like concat ('%', #{keyword},'%') or t3.NAME_ like concat ('%', #{keyword},'%'))
      </if>
      <if test="@com.server.edu.util.MybatisUtil@isNotEmpty(campus)">
        and t2.CAMPUS_ = #{campus}
      </if>
      <if test="@com.server.edu.util.MybatisUtil@isNotEmpty(collenge)">
        and t2.FACULTY_ = #{collenge}
      </if>
      <if test="@com.server.edu.util.MybatisUtil@isNotEmpty(applyType)">
        and t1.APPLY_TYPE_ = #{applyType}
      </if>
      <if test="@com.server.edu.util.MybatisUtil@isNotEmpty(applyStatus)">
        and t1.APPLY_STATUS_ = #{applyStatus}
      </if>
      <if test="@com.server.edu.util.MybatisUtil@isNotEmpty(calendarId)">
        and t1.CALENDAR_ID_ = #{calendarId}
      </if>
      <if test="@com.server.edu.util.MybatisUtil@isNotEmpty(projId)">
        and t1.PROJ_ID_ = #{projId}
      </if>
      <if test="@com.server.edu.util.MybatisUtil@isNotEmpty(isAdmin)">
        and t1.APPLY_STATUS_ >= 2
      </if>
      <if test="@com.server.edu.util.MybatisUtil@isNotEmpty(ids)">
        and t1.ID_ in
        <foreach collection="ids" item="id" open="(" separator="," close=")">
          #{id}
        </foreach>
      </if>
    </where>
    order by t1.ID_ desc
  </select>

  <update id="updateByList">
    <foreach collection="list" item="id" separator=";">
      update graduate_exam_apply_examination_t set APPLY_STATUS_ = #{applyStatus} , ADUIT_OPINIONS_ =#{aduitOpinions}  where ID_ = #{id}
    </foreach>

  </update>

</mapper>