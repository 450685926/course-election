<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.server.edu.election.dao.ElcLogDao">
  <resultMap id="BaseResultMap" type="com.server.edu.election.entity.ElcLog">
    <!--
      WARNING - @mbg.generated
    -->
    <id column="ID_" jdbcType="BIGINT" property="id" />
    <result column="STUDENT_ID_" jdbcType="VARCHAR" property="studentId" />
    <result column="COURSE_CODE_" jdbcType="VARCHAR" property="courseCode" />
    <result column="COURSE_NAME_" jdbcType="VARCHAR" property="courseName" />
    <result column="TEACHING_CLASS_CODE_" jdbcType="VARCHAR" property="teachingClassCode" />
    <result column="CALENDAR_ID_" jdbcType="BIGINT" property="calendarId" />
    <result column="TYPE_" jdbcType="INTEGER" property="type" />
    <result column="MODE_" jdbcType="INTEGER" property="mode" />
    <result column="TURN_" jdbcType="INTEGER" property="turn" />
    <result column="CREATE_BY_" jdbcType="VARCHAR" property="createBy" />
    <result column="CREATE_IP_" jdbcType="VARCHAR" property="createIp" />
    <result column="CREATED_AT_" jdbcType="TIMESTAMP" property="createdAt" />
    <result column="CREATE_NAME_" jdbcType="VARCHAR" property="createName" />
    <result column="CONTENT_" jdbcType="VARCHAR" property="content" />


  </resultMap>
  
  <resultMap type="com.server.edu.election.vo.ElcLogVo" id="VoElcLogMap" extends="BaseResultMap">
  	<result column="NAME_" jdbcType="VARCHAR" property="studentName" />
  	<result column="CAMPUS_" jdbcType="VARCHAR" property="campus" />
  	<result column="PROFESSION_" jdbcType="VARCHAR" property="profession" />
  </resultMap>
  
  <select id="listPage" resultMap="VoElcLogMap">
  	select t1.*, t2.NAME_, t2.CAMPUS_, t2.PROFESSION_
  	from election_log_t t1 
  	left join student_t t2 ON t2.STUDENT_CODE_ = t1.STUDENT_ID_
  	<where>
  		t1.CALENDAR_ID_ =#{query.calendarId,jdbcType=BIGINT}
	  	<if test="@com.server.edu.util.MybatisUtil@isNotEmpty(query.studentId)">
	  	and t1.STUDENT_ID_ = #{query.studentId}
	  	</if>
	  	<if test="@com.server.edu.util.MybatisUtil@isNotEmpty(query.studentIds)">
		and t1.STUDENT_ID_ IN 
		  	<foreach item="id" collection="query.studentIds"  index="index" open="(" separator="," close=")">  
		       #{id}  
		    </foreach>
	  	</if>
	  	<if test="@com.server.edu.util.MybatisUtil@isNotEmpty(query.type)">
	  	and t1.TYPE_ = #{query.type}
	  	</if>
	  	<if test="@com.server.edu.util.MybatisUtil@isNotEmpty(query.mode)">
	  	and t1.MODE_ = #{query.mode}
	  	</if>
  	</where>
  </select>

    <select id="findCourseLog" parameterType="com.server.edu.election.vo.ElcLogVo" resultMap="VoElcLogMap">
        select t1.*,t2.NAME_ from  election_log_t t1
        left join student_t t2 ON t2.STUDENT_CODE_ = t1.STUDENT_ID_
        <where>
            <if test="@com.server.edu.util.MybatisUtil@isNotEmpty(teachingClassCode)">
                and t1.TEACHING_CLASS_CODE_ like concat('%',#{teachingClassCode},'%')
            </if>
            <if test="@com.server.edu.util.MybatisUtil@isNotEmpty(courseCode)">
                and t1.COURSE_CODE_ like concat('%',#{courseCode},'%')
            </if>
            <if test="@com.server.edu.util.MybatisUtil@isNotEmpty(courseName)">
                and t1.COURSE_NAME_ like concat('%',#{courseName},'%')
            </if>
            <if test="@com.server.edu.util.MybatisUtil@isNotEmpty(calendarId)">
                and t1.CALENDAR_ID_ =#{calendarId}
            </if>
            <if test="@com.server.edu.util.MybatisUtil@isNotEmpty(keyWord)">
                and (t2.STUDENT_CODE_ like concat('%',#{keyWord},'%') or t2.NAME_ like concat('%',#{keyWord},'%'))
            </if>
            <if test="@com.server.edu.util.MybatisUtil@isNotEmpty(startTime)">
                <![CDATA[
				and unix_timestamp(t1.CREATED_AT_) >= unix_timestamp(#{startTime})
			    ]]>
            </if>
            <if test="@com.server.edu.util.MybatisUtil@isNotEmpty(endTime)">
                <![CDATA[
				and unix_timestamp(t1.CREATED_AT_) <= unix_timestamp(#{endTime})
			    ]]>
            </if>
            <if test="@com.server.edu.util.MybatisUtil@isNotEmpty(deptId)">
                and t2.MANAGER_DEPT_ID_ = #{deptId}
            </if>
        </where>
    </select>
</mapper>