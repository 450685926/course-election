<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.server.edu.mutual.dao.ElcMutualStdsDao">
  <resultMap id="BaseResultMap" type="com.server.edu.mutual.entity.ElcMutualStds">
    <!--
      WARNING - @mbg.generated
    -->
    <id column="ID_" jdbcType="BIGINT" property="id" />
    <result column="CALENDAR_ID_" jdbcType="BIGINT" property="calendarId" />
    <result column="STUDENT_ID_" jdbcType="VARCHAR" property="studentId" />
  </resultMap>
  <select id="getMutualStds" parameterType="com.server.edu.mutual.dto.ElcMutualCrossStuDto" resultType="com.server.edu.mutual.vo.ElcMutualCrossStuVo">
		SELECT
		  t1.ID_ id,
		  t1.`CALENDAR_ID_` calendarId,
		  t1.`STUDENT_ID_` studentId,
		  t2.`NAME_` studentName,
		  t2.`SEX_` sex,
		  t2.`TRAINING_LEVEL_` trainingLevel,
		  t2.`FACULTY_` faculty,
		  t2.`PROFESSION_` profession,
		  t2.`GRADE_` grade,
		  t2.`MANAGER_DEPT_ID_` projectId,
		  t2.TRAINING_CATEGORY_ trainingCategory,
		  t2.DEGREE_CATEGORY_ degreeCategory,
		  t2.FORM_LEARNING_ formLearning
		FROM
		  `elc_mutual_stds_t` t1 
		  JOIN `student_t` t2 
		    ON t1.`STUDENT_ID_` = t2.`STUDENT_CODE_` 
		<where>
		    t1.CALENDAR_ID_  = #{calendarId}
		    <if test="@com.server.edu.util.MybatisUtil@isNotEmpty(studentId)">
		        and t1.STUDENT_ID_ like concat ('%', #{studentId},'%')
		    </if>
		    <if test="@com.server.edu.util.MybatisUtil@isNotEmpty(studentName)">
		        and t2.NAME_ like concat ('%', #{studentName},'%')
		    </if>
		    <if test="@com.server.edu.util.MybatisUtil@isNotEmpty(keyWords)">
		        and (t1.STUDENT_ID_ like concat ('%', #{keyWords},'%') or t2.NAME_ like concat ('%', #{keyWords},'%')) 
		    </if>
		    <if test="@com.server.edu.util.MybatisUtil@isNotEmpty(projectId)">
		        and t2.MANAGER_DEPT_ID_  = #{projectId}
		    </if>
		    <if test="@com.server.edu.util.MybatisUtil@isNotEmpty(grade)">
		        and t2.GRADE_  = #{grade}
		    </if>
		    <if test="@com.server.edu.util.MybatisUtil@isNotEmpty(faculty)">
				and t2.FACULTY_  in
				<foreach item="item" index="index" collection="faculty.split(',')" open="(" separator="," close=")">
					'${item}'
				</foreach>
		    </if>
		    <if test="@com.server.edu.util.MybatisUtil@isNotEmpty(profession)">
		        and t2.PROFESSION_  = #{profession}
		    </if>			    
		    <if test="@com.server.edu.util.MybatisUtil@isNotEmpty(trainingLevel)">
		        and t2.TRAINING_LEVEL_  = #{trainingLevel}
		    </if>
		    <if test="@com.server.edu.util.MybatisUtil@isNotEmpty(trainingCategory)">
		        and t2.TRAINING_CATEGORY_  = #{trainingCategory}
		    </if>
		    <if test="@com.server.edu.util.MybatisUtil@isNotEmpty(degreeCategory)">
		        and t2.DEGREE_CATEGORY_  = #{degreeCategory}
		    </if>
		    <if test="@com.server.edu.util.MybatisUtil@isNotEmpty(formLearning)">
		        and t2.FORM_LEARNING_  = #{formLearning}
		    </if>
		    <if test="@com.server.edu.util.MybatisUtil@isNotEmpty(leaveSchool)">
		        and t2.LEAVE_SCHOOL_  = #{leaveSchool}
		    </if>
		</where>  
  </select>
  
  <select id="isInElcMutualStdList" parameterType="com.server.edu.mutual.dto.ElcMutualCrossStuDto" resultType="com.server.edu.mutual.vo.ElcMutualCrossStuVo">
		SELECT
		  ID_ id,
		  CALENDAR_ID_ calendarId,
		  STUDENT_ID_ studentId
		FROM
		  elc_mutual_stds_t
		<where>
		    <if test="@com.server.edu.util.MybatisUtil@isNotEmpty(calendarId)">
		        and CALENDAR_ID_ = #{calendarId}
		    </if>
		    <if test="@com.server.edu.util.MybatisUtil@isNotEmpty(studentId)">
		        and STUDENT_ID_ = #{studentId}
		    </if>
		</where>  
  </select>
</mapper>