<?xml key="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.server.edu.election.dao.ElecRoundsDao">
  <resultMap id="BaseResultMap" type="com.server.edu.election.entity.ElectionRounds">
    <!--
      WARNING - @mbg.generated
    -->
    <id column="ID_" jdbcType="BIGINT" property="id" />
    <result column="CALENDAR_ID_" jdbcType="BIGINT" property="calendarId" />
    <result column="TURN_" jdbcType="INTEGER" property="turn" />
    <result column="ELECTION_OBJ_" jdbcType="VARCHAR" property="electionObj" />
    <result column="MODE_" jdbcType="INTEGER" property="mode" />
    <result column="PROJECT_ID_" jdbcType="INTEGER" property="projectId" />
    <result column="NAME_" jdbcType="VARCHAR" property="name" />
    <result column="OPEN_FLAG_" jdbcType="INTEGER" property="openFlag" />
    <result column="BEGIN_TIME_" jdbcType="TIMESTAMP" property="beginTime" />
    <result column="END_TIME_" jdbcType="TIMESTAMP" property="endTime" />
    <result column="REMARK_" jdbcType="VARCHAR" property="remark" />
    <result column="CREATED_AT_" jdbcType="TIMESTAMP" property="createdAt" />
    <result column="UPDATED_AT_" jdbcType="TIMESTAMP" property="updatedAt" />
  </resultMap>
  
  <resultMap id="DtoBaseResultMap" type="com.server.edu.election.dto.ElectionRoundsDto" extends="BaseResultMap"></resultMap>
  
  <select id="listPage" resultMap="BaseResultMap">
  	select * from election_rounds_t 
  	<where>
  		PROJECT_ID_ = #{round.projectId}
  		and CALENDAR_ID_ = #{round.calendarId}
  		and MODE_ = #{round.mode}
  		<if test="@com.server.edu.util.MybatisUtil@isNotEmpty(round.electionObj)">
  		and ELECTION_OBJ_ = #{round.electionObj}
  		</if>
  	</where>
  </select>
  
  <select id="getOne" resultMap="DtoBaseResultMap">
  	select * from election_rounds_t where ID_ = #{roundId}
  </select>
  
  <insert id="saveRoundRefRule">
  	insert into election_rounds_ref_rule_t(ROUNDS_ID_, RULE_ID_) values(#{roundId}, #{ruleId})
  </insert>
  
  <delete id="deleteAllRefRule">
  	delete from election_rounds_ref_rule_t where ROUNDS_ID_ = #{roundId}
  </delete>
  
  <select id="listAllRefRuleId" resultType="long">
  	select RULE_ID_ from election_rounds_ref_rule_t where ROUNDS_ID_ = #{roundId}
  </select>
</mapper>