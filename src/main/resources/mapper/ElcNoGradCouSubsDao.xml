<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.server.edu.election.dao.ElcNoGradCouSubsDao">
  <resultMap id="BaseResultMap" type="com.server.edu.election.entity.ElcNoGradCouSubs">
    <!--
      WARNING - @mbg.generated
    -->
    <id column="ID_" jdbcType="BIGINT" property="id" />
    <result column="STUDENT_ID_" jdbcType="VARCHAR" property="studentId" />
    <result column="PROJECT_ID_" jdbcType="VARCHAR" property="projectId" />
    <result column="ORIGS_COURSE_ID_" jdbcType="VARCHAR" property="origsCourseId" />
    <result column="SUB_COURSE_ID_" jdbcType="VARCHAR" property="subCourseId" />
    <result column="REMARK_" jdbcType="VARCHAR" property="remark" />
    <result column="CREATED_AT_" jdbcType="DATE" property="createdAt" />
    <result column="UPDATED_AT" jdbcType="DATE" property="updatedAt" />
  </resultMap>
  
  <resultMap id="subsMap" type="com.server.edu.election.vo.ElcNoGradCouSubsVo" extends="com.server.edu.election.dao.ElcNoGradCouSubsDao.BaseResultMap">
    <result column="origsCourseName" jdbcType="VARCHAR" property="origsCourseName" />
    <result column="origsCredits" jdbcType="INTEGER" property="origsCredits" />
    <result column="subCourseName" jdbcType="VARCHAR" property="subCourseName" />
    <result column="subCredits" jdbcType="INTEGER" property="subCredits" />
    <result column="NAME_" jdbcType="VARCHAR" property="studentName" />
    <result column="GRADE_" jdbcType="INTEGER" property="grade" />
    <result column="FACULTY_" jdbcType="VARCHAR" property="faculty" />
    <result column="PROFESSION_" jdbcType="VARCHAR" property="profession" />
  </resultMap>
  <select id="selectElcNoGradCouSubs" parameterType="com.server.edu.election.dto.ElcNoGradCouSubsDto" resultMap="subsMap">
		SELECT
		   t1.ID_,
		   t1.STUDENT_ID_,
		   t1.PROJECT_ID_,
		   t1.ORIGS_COURSE_ID_,
		   t1.SUB_COURSE_ID_,
		   t4.NAME_,
		   t4.GRADE_,
		   t4.FACULTY_,
		   t4.PROFESSION_,
		   t2.NAME_ origsCourseName,
		   t2.CREDITS_ origsCredits,
		   t3.NAME_ subCourseName,
		   t3.CREDITS_ subCredits
		FROM
			elc_no_grad_cou_subs_t t1
		LEFT JOIN course_t t2 ON t1.ORIGS_COURSE_ID_ = t2.CODE_
		LEFT JOIN course_t t3 ON t1.SUB_COURSE_ID_ = t3.CODE_
		JOIN  student_t t4 ON t1.student_ID_ = t4.STUDENT_CODE_
		<where>
		    <if test="@com.server.edu.util.MybatisUtil@isNotEmpty(studentIds)">
		        and t1.STUDENT_ID_ in
		        <foreach item="studentId" collection="studentIds" index="index" open="(" separator="," close=")">
		          #{studentId}
		        </foreach>
		    </if>
		    <if test="@com.server.edu.util.MybatisUtil@isNotEmpty(studentId)">
		        and t1.STUDENT_ID_ = #{studentId}
		    </if>
		    <if test="@com.server.edu.util.MybatisUtil@isNotEmpty(grade)">
		        and t4.GRADE_ = #{grade}
		    </if>
		    <if test="@com.server.edu.util.MybatisUtil@isNotEmpty(faculty)">
		        and t4.FACULTY_ = #{faculty}
		    </if>
		    <if test="@com.server.edu.util.MybatisUtil@isNotEmpty(profession)">
		        and t4.PROFESSION_ = #{profession}
		    </if>
		    <if test="@com.server.edu.util.MybatisUtil@isNotEmpty(origsCourseId)">
		        and t1.ORIGS_COURSE_ID_  =#{origsCourseId}
		    </if>
		    <if test="@com.server.edu.util.MybatisUtil@isNotEmpty(origsCourseName)">
		        and t2.NAME_ = #{origsCourseName}
		    </if>
		    <if test="@com.server.edu.util.MybatisUtil@isNotEmpty(subCourseId)">
		        and t1.SUB_COURSE_ID_  =#{subCourseId}
		    </if>
		    <if test="@com.server.edu.util.MybatisUtil@isNotEmpty(subCourseName)">
		        and t3.NAME_ = #{subCourseName}
		    </if>		    
		</where>
		 ORDER BY t1.CREATED_AT_ DESC
  </select>
</mapper>