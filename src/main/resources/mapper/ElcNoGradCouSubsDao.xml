<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.server.edu.election.dao.ElcNoGradCouSubsDao">
  <resultMap id="BaseResultMap" type="com.server.edu.election.entity.ElcNoGradCouSubs">
    <!--
      WARNING - @mbg.generated
    -->
    <id column="ID_" jdbcType="BIGINT" property="id" />
    <result column="PROJECT_ID_" jdbcType="VARCHAR" property="projectId" />
    <result column="CALENDAR_ID_" jdbcType="BIGINT" property="calendarId" />
    <result column="ORIGS_COURSE_ID_" jdbcType="VARCHAR" property="origsCourseId" />
    <result column="SUB_COURSE_ID_" jdbcType="VARCHAR" property="subCourseId" />
    <result column="REMARK_" jdbcType="VARCHAR" property="remark" />
    <result column="CREATED_AT_" jdbcType="TIMESTAMP" property="createdAt" />
    <result column="UPDATED_AT" jdbcType="TIMESTAMP" property="updatedAt" />
  </resultMap>
  
  <resultMap id="subsMap" type="com.server.edu.election.vo.ElcNoGradCouSubsVo" extends="com.server.edu.election.dao.ElcNoGradCouSubsDao.BaseResultMap">
    <result column="origsCourseName" jdbcType="VARCHAR" property="origsCourseName" />
    <result column="origsCredits" jdbcType="INTEGER" property="origsCredits" />
    <result column="subCourseName" jdbcType="VARCHAR" property="subCourseName" />
    <result column="subCredits" jdbcType="INTEGER" property="subCredits" />
  </resultMap>
  <select id="selectElcNoGradCouSubs" parameterType="com.server.edu.election.entity.ElcNoGradCouSubs" resultMap="subsMap">
		SELECT
			t1.*, t2.NAME_ origsCourseName,
			t2.CREDITS_ origsCredits,
			t3.NAME_ subCourseName,
			t3.CREDITS_ subCredits
		FROM
			elc_no_grad_cou_subs_t t1
		LEFT JOIN course_t t2 ON t1.ORIGS_COURSE_ID_ = t2.CODE_
		LEFT JOIN course_t t3 ON t1.SUB_COURSE_ID_ = t3.CODE_
		<where>
		    <if test="@com.server.edu.util.MybatisUtil@isNotEmpty(projectId)">
		        and t1.PROJECT_ID_  = #{projectId}
		    </if>
		    <if test="@com.server.edu.util.MybatisUtil@isNotEmpty(calendarId)">
		        and t1.CALENDAR_ID_  = #{calendarId}
		    </if>
		    <if test="@com.server.edu.util.MybatisUtil@isNotEmpty(origsCourseId)">
		        and (t1.ORIGS_COURSE_ID_  like concat(#{origsCourseId},'%') or t2.NAME_ like concat(#{origsCourseId},'%') )
		    </if>
		    <if test="@com.server.edu.util.MybatisUtil@isNotEmpty(subCourseId)">
		        and (t1.SUB_COURSE_ID_  like concat(#{subCourseId},'%') or t3.NAME_ like concat(#{subCourseId},'%') )
		    </if>
		    ORDER BY t1.CREATED_AT_ DESC		    
		</where>
  </select>
</mapper>